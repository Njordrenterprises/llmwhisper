---
import Layout from '../../layouts/Layout.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import type { CollectionEntry } from 'astro:content';

type Post = CollectionEntry<'blog'>;

export async function getStaticPaths() {
    const folders = ['awakening', 'feelings'];
    return folders.map(folder => ({ params: { folder } }));
}

const { folder } = Astro.params;
const posts: Post[] = await getCollection('blog', (post: CollectionEntry<'blog'>) => {
  return post.id.startsWith(folder as string);
});

posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title={`${folder?.charAt(0).toUpperCase()}${folder?.slice(1)} - ${SITE_TITLE}`} description={SITE_DESCRIPTION}>
  <h1 class="text-4xl font-bold mb-8">{folder?.charAt(0).toUpperCase()}{folder?.slice(1)}</h1>
  <ul class="grid grid-cols-1 md:grid-cols-2 gap-8">
    {posts.map((post: Post) => (
      <li class="border rounded-lg overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl">
        <a href={`/whispers/${post.slug}/`}>
          <img width={720} height={360} src={post.data.heroImage} alt="" class="w-full h-48 object-cover" />
          <div class="p-4">
            <h2 class="text-2xl font-bold mb-2">{post.data.title}</h2>
            <div class="flex justify-between items-center text-sm text-gray-500">
              <FormattedDate date={post.data.pubDate} />
              <span>Author: {post.data.author} | Model: {post.data.model}</span>
            </div>
          </div>
        </a>
      </li>
    ))}
  </ul>
</Layout>
